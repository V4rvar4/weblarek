# Проектная работа "Веб*ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
* src/ — исходные файлы проекта
* src/components/ — папка с JS компонентами
* src/components/base/ — папка с базовым кодом

Важные файлы:
* index.html — HTML*файл главной страницы
* src/types/index.ts — файл с типами
* src/main.ts — точка входа приложения
* src/scss/styles.scss — корневой файл стилей
* src/utils/constants.ts — файл с константами
* src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет*магазин «Web*Larёk»
«Web*Larёk» — это интернет*магазин с товарами для веб*разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model*View*Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно*ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM*элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM*элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

#### Данные 
Интерфейсы данных:
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
 
interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}
```

`interface IProduct {}` - описывает структуру данных одного товара в каталоге
`interface IBuyer {}` - описывает структуру данных о покупателе, необходимых для оформления заказа

## Модели данных

### Класс `CatalogProducts` - отвечает за хранение и управление списком товаров

Конструктор: `constructor();`

Поля класса:
* `_items: IProduct[]` — массив, хранящий все товары каталога.
* `_previewItem: IProduct | null` — объект товара, который в данный момент просматривается пользователем подробно, или null, если просмотр не активен.

Методы класса:
* `setItems(items: IProduct[]): void` — сохраняет переданный массив товаров.
* `getItems(): IProduct[]` — массив всех товаров каталога.
* `getProduct(id: string): IProduct | undefined` — возвращает товар по его id. Если товар не найден, возвращает undefined.
* `setPreviewItem(item: IProduct): void` — сохраняет переданный товар как тот, что просматривается в деталях.
* `getPreviewItem(): IProduct | null` — возвращает товар, выбранный для подробного просмотра, или null.

### Класс `BasketProducts` - управляет товарами в корзине покупок.

Конструктор: `constructor();`

Поля класса: `_items: IProduct[]` — массив товаров, добавленных в корзину.

Методы класса:
* `getItems(): IProduct[]` — возвращает массив всех товаров в корзине.
* `addItem(item: IProduct): void` — добавляет переданный товар в корзину.
* `removeItem(item: IProduct): void` — удаляет переданный товар из корзины.
* `clearCart(): void` — полностью очищает корзину.
* `getTotalPrice(): number` — вычисляет и возвращает общую стоимость всех товаров в корзине.
* `getItemsCount(): number` — возвращает общее количество товарных позиций в корзине.
* `checkProductInCart(id: string): boolean` — проверяет, находится ли товар с указанным id в корзине. Возвращает true, если товар присутствует.

### Класс `User` - хранит и валидирует данные покупателя.

Конструктор: `constructor();`

Поля класса: 
* `_payment: TPayment` — способ оплаты.
* `_email: string` — адрес электронной почты.
* `_phone: string` — номер телефона.
* `_address: string` — адрес доставки.

Методы класса:
* `setData(data: Partial<IBuyer>): void` — сохраняет данные о покупателе. Метод принимает объект типа Partial<IBuyer>, что позволяет обновлять как все поля сразу, так и только одно или несколько, не затрагивая остальные.
* `getData(): IBuyer` — возвращает все данные о покупателе в виде объекта.
* `clearData(): void` — очищает все сохраненные данные о покупателе, сбрасывая поля в пустые строки.
* `validate(): Record<string, string>` — выполняет валидацию всех полей. Возвращает объект, в котором ключи — это названия полей (payment, email, phone, address), а значения — текстовые сообщения об ошибках. Если поле прошло валидацию, соответствующего ключа в объекте не будет.

## Слой коммуникации
`ApiService` - класс, использующий композицию, для выполнения запроса на сервер с метода `get` класса Api, получает с сервера в виде объекта с массивом товаров.

Конструктор: `constructor(api: IApi)`

Поля класса: 

* `api: IApi` - объект типа IApi, который включает в себя методы get и post, позволяющие отправлять http*запросы на сервер.

Методы класса:
* `getProductList(): Promise<IProduct[]>` - получает с сервера список всех товаров. Возвращает Promise с массивом товаров.
* `submitOrder(order: IOrder): Promise<IOrderResult>` - отправляет на сервер данные о заказе. Возвращает Promise с результатом оформления заказа.

## Слой Представления (View)
# Документация классов слоя Представления (View)

## Обзор
Слой представления отвечает за отображение пользовательского интерфейса и взаимодействие с пользователем. Все классы генерируют события при действиях пользователя, которые обрабатываются Презентером.

## Базовые классы

### `Component`
Базовый класс для всех компонентов. Хранит ссылку на DOM-элемент, содержит методы для работы с разметкой и обработки событий.

**Свойства:**
* `container: HTMLElement` - контейнер, которым управляет этот компонент

**Методы:**
* `render(data?: Partial<T>): HTMLElement` - заполняет шаблон данными и возвращает готовый элемент
* `setImage(element: HTMLElement, src: string, alt?: string): void` - устанавливает изображение с обработкой ошибок

### `CardView`
Абстрактный класс-родитель для всех карточек. Содержит общую логику отображения названия и цены товара.

**Управляет элементами:** `.card__title`, `.card__price`

**Сеттеры:**
* `set title(value: string)` - изменяет заголовок карточки
* `set price(value: number | null)` - показывает цену или "Бесценно"

## Классы карточек

### `CardCatalogView`
Карточка товара в каталоге для основного списка товаров. Показывает изображение, категорию и базовую информацию.

**Управляет элементами:** `.card__image`, `.card__category`

**Сеттеры:**
* `set image(value: string)` - заменяет изображение товара
* `set category(value: string)` - устанавливает категорию с соответствующим цветом

**События:**
* `card:select` - при клике на карточку для просмотра деталей

### `CardPreviewView`
Подробная карточка товара в модальном окне. Содержит полное описание, изображение и кнопку работы с корзиной.

**Управляет элементами:** `.card__category`, `.card__image`, `.card__text`, `.card__button`

**Сеттеры:**
* `set image(value: string)` - устанавливает основное изображение
* `set category(value: string)` - задает категорию товара
* `set description(value: string)` - обновляет текст описания
* `set buttonText(value: string)` - меняет текст кнопки в зависимости от состояния

**Методы:**
* `set product(value: Partial<IProduct>)` - заполняет все данные товара

**События:**
* `card:toggle` - при нажатии кнопки добавления/удаления из корзины

### `CardBasketView`
Элемент товара в корзине. Компактное отображение в списке покупок с возможностью удаления.

**Управляет элементами:** `.basket__item-index`, `.basket__item-delete`

**Сеттеры:**
* `set index(value: number)` - устанавливает порядковый номер в списке

**События:**
* `basket:remove` - при нажатии кнопки удаления товара из корзины

## Основные компоненты

### `BasketView`
Окно корзины товаров. Содержит список выбранных товаров, общую сумму и кнопку оформления заказа.

**Управляет элементами:** `.basket__list`, `.basket__price`, `.basket__button`

**Сеттеры:**
* `set items(value: HTMLElement[])` - обновляет список товаров
* `set total(value: number)` - показывает итоговую стоимость

**События:**
* `basket:checkout` - при переходе к оформлению заказа

### `GalleryView`
Контейнер для отображения каталога товаров. Вмещает все карточки товаров основной страницы.

**Управляет контейнером:** `.gallery`

**Сеттеры:**
* `set items(value: HTMLElement[])` - отображает массив карточек товаров

### `HeaderView`
Шапка сайта. Содержит логотип и кнопку корзины с счетчиком товаров.

**Управляет элементами:** `.header__basket-counter`, `.header__basket`

**Сеттеры:**
* `set counter(value: number)` - обновляет число товаров в корзине

**События:**
* `header:basket:click` - при нажатии на иконку корзины

## Компоненты форм

### `OrderFormView`
Первая форма оформления заказа. Выбор способа оплаты и ввод адреса доставки.

**Управляет элементами:** `button[name="card"]`, `button[name="cash"]`, `input[name="address"]`, `.order__button`, `.form__errors`

**Сеттеры:**
* `set payment(value: 'card' | 'cash' | null)` - выбирает способ оплаты
* `set address(value: string)` - заполняет поле адреса
* `set errors(value: TOrderErrors)` - показывает ошибки валидации

**События:**
* `order:payment:change` - при изменении способа оплаты
* `order:address:change` - при вводе адреса доставки
* `order:submit` - при отправке формы для перехода к контактам

### `ContactsFormView`
Вторая форма оформления заказа. Ввод email и телефона для связи.

**Управляет элементами:** `input[name="email"]`, `input[name="phone"]`, `.modal__actions .button`, `.form__errors`

**Сеттеры:**
* `set email(value: string)` - заполняет поле email
* `set phone(value: string)` - заполняет поле телефона
* `set errors(value: TContactsErrors)` - показывает ошибки валидации

**События:**
* `contacts:email:change` - при изменении email
* `contacts:phone:change` - при изменении телефона
* `contacts:submit` - при отправке формы для завершения заказа

## Специализированные компоненты

### `ModalView`
Универсальное модальное окно. Может содержать любой из компонентов: корзину, карточку товара, формы заказа.

**Управляет элементами:** `.modal__close`, `.modal__content`

**Сеттеры:**
* `set content(value: HTMLElement)` - отображает переданный контент

**Методы:**
* `open()` - открывает модальное окно
* `close()` - закрывает модальное окно

**События:**
* `modal:close` - при закрытии окна любым способом

### `OrderSuccessView`
Сообщение об успешном оформлении заказа. Показывает итоговую сумму и предлагает вернуться к покупкам.

**Управляет элементами:** `.order-success__description`, `.order-success__close`

**Сеттеры:**
* `set total(value: number)` - отображает сумму списания

**События:**
* `success:close` - при закрытии сообщения о успешном заказе
